<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>HelpTech Antunes - PDFs</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-bottom: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
    label { display: block; margin-top: 8px; }
    input, textarea { padding: 6px; margin-top: 3px; width: 250px; }
    button { margin-top: 12px; padding: 8px 16px; background: #008f39; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #006f2c; }
    h2 { color: #008f39; }
  </style>
</head>
<body>

  <h1>üìë HelpTech Antunes - Gera√ß√£o de PDFs</h1>

  <!-- FORM OR√áAMENTO -->
  <form id="formOrc">
    <h2>Or√ßamento</h2>
    <label>Cliente: <input type="text" name="cliente" required></label>
    <label>Servi√ßo: <input type="text" name="servicos" required></label>
    <label>Valor: <input type="number" step="0.01" name="valores" required></label>
    <button type="submit">Gerar Or√ßamento</button>
  </form>

  <!-- FORM NOTA FISCAL -->
  <form id="formNF">
    <h2>Nota Fiscal</h2>
    <label>N√∫mero: <input type="text" name="numero" required></label>
    <label>Cliente: <input type="text" name="cliente" required></label>
    <label>Servi√ßo: <input type="text" name="servico" required></label>
    <label>Valor: <input type="number" step="0.01" name="valor" required></label>
    <button type="submit">Gerar Nota Fiscal</button>
  </form>

  <!-- FORM CONTRATO -->
  <form id="formContrato">
    <h2>Contrato</h2>
    <label>Cliente: <input type="text" name="cliente" required></label>
    <label>Descri√ß√£o: <input type="text" name="descricao" required></label>
    <button type="submit">Gerar Contrato</button>
  </form>

  <!-- FORM RECIBO -->
  <form id="formRecibo">
    <h2>Recibo</h2>
    <label>Cliente: <input type="text" name="cliente" required></label>
    <label>Valor: <input type="number" step="0.01" name="valor" required></label>
    <button type="submit">Gerar Recibo</button>
  </form>

  <!-- FORM CARTA -->
  <form id="formCarta">
    <h2>Carta</h2>
    <label>Destinat√°rio: <input type="text" name="destinatario" required></label>
    <label>Mensagem: <textarea name="mensagem" rows="3" required></textarea></label>
    <button type="submit">Gerar Carta</button>
  </form>

 <!-- ====== CERTIFICADO ‚Äì CARD ====== -->
<section class="card card-cert">
  <header class="card__header">
    <div class="card__title">
      <h2>üèÖ Gerar Certificado</h2>
      <p>Preencha os dados do participante e do evento/curso.</p>
    </div>
  </header>

  <form id="formCertificado" class="form-grid">
    <!-- Participante -->
    <div class="form-group col-2">
      <label for="nome">Nome do Participante <span>*</span></label>
      <input id="nome" name="nome" type="text" required placeholder="Ex.: Alison Antunes" maxlength="120">
      <small class="hint">Nome completo para impress√£o.</small>
    </div>

    <!-- Curso / Evento -->
    <div class="form-group col-2">
      <label for="curso">Curso/Evento <span>*</span></label>
      <input id="curso" name="curso" type="text" required placeholder="Ex.: Angular Avan√ßado" maxlength="120">
    </div>

    <!-- Carga hor√°ria -->
    <div class="form-group">
      <label for="carga">Carga Hor√°ria (h)</label>
      <input id="carga" name="carga" type="number" min="1" step="1" placeholder="Ex.: 20">
    </div>

    <!-- Per√≠odo -->
    <div class="form-group">
      <label>Per√≠odo</label>
      <div class="inline">
        <input id="dataInicio" name="data_inicio" type="date">
        <span class="sep">‚Äî</span>
        <input id="dataFim" name="data_fim" type="date">
      </div>
      <small class="hint">Preencha in√≠cio e fim, ou use apenas ‚ÄúData de Conclus√£o‚Äù.</small>
    </div>

    <!-- Data de Conclus√£o -->
    <div class="form-group">
      <label for="dataConclusao">Data de Conclus√£o</label>
      <input id="dataConclusao" name="data_conclusao" type="date">
    </div>

    <!-- Instrutor -->
    <div class="form-group">
      <label for="instrutor">Instrutor(a) / Respons√°vel</label>
      <input id="instrutor" name="instrutor" type="text" placeholder="Ex.: Jo√£o Silva">
    </div>

    <!-- Local -->
    <div class="form-group">
      <label for="local">Local</label>
      <input id="local" name="local" type="text" placeholder="Ex.: Jundia√≠ ‚Äì SP">
    </div>

    <!-- Assinatura (texto) -->
    <div class="form-group col-2">
      <label for="assinatura">Linha de Assinatura</label>
      <input id="assinatura" name="assinatura" type="text" placeholder="HelpTech Antunes ‚Ä¢ CNPJ 00.000.000/0001-00">
      <small class="hint">Rodap√© do certificado (empresa, CNPJ, etc.).</small>
    </div>

    <!-- Template / Tema -->
    <div class="form-group">
      <label for="template">Modelo</label>
      <select id="template" name="template">
        <option value="classico">Cl√°ssico</option>
        <option value="moderno">Moderno</option>
        <option value="minimalista">Minimalista</option>
      </select>
    </div>

    <div class="form-group">
      <label for="corTema">Cor do Tema</label>
      <input id="corTema" name="cor_tema" type="color" value="#2e7d32">
    </div>

    <!-- QR + Observa√ß√µes -->
    <div class="form-group">
      <label class="checkbox">
        <input id="incluirQr" name="incluir_qr" type="checkbox" checked>
        Incluir QR de verifica√ß√£o
      </label>
    </div>

    <div class="form-group col-2">
      <label for="observacoes">Observa√ß√µes</label>
      <textarea id="observacoes" name="observacoes" rows="3" placeholder="Ex.: Certificado v√°lido para comprova√ß√£o de horas complementares."></textarea>
    </div>

    <!-- A√ß√µes -->
    <div class="form-actions col-2">
      <button type="submit" class="btn btn-primary">Gerar PDF</button>
      <button type="reset" class="btn btn-ghost">Limpar</button>
      <div id="statusCert" class="status" aria-live="polite"></div>
    </div>
  </form>
</section>

<style>
  /* ====== Card base ====== */
  .card { background:#fff; border:1px solid #e6e6e6; border-radius:18px; box-shadow:0 4px 18px rgba(0,0,0,.06); }
  .card__header{ padding:18px 20px 0; }
  .card__title h2{ margin:0; font-size:1.25rem }
  .card__title p{ margin:.25rem 0 1rem; color:#666 }

  /* ====== Form grid ====== */
  .form-grid{ padding:16px 20px 20px; display:grid; grid-template-columns:1fr; gap:14px }
  .col-2{ grid-column:span 1 }
  @media (min-width: 860px){
    .form-grid{ grid-template-columns:1fr 1fr }
    .col-2{ grid-column:span 2 }
  }
  .form-group{ display:flex; flex-direction:column; gap:6px }
  label span{ color:#c0392b }
  input[type="text"], input[type="date"], input[type="number"], input[type="color"], select, textarea{
    padding:10px 12px; border:1px solid #d9d9d9; border-radius:12px; font:inherit; outline:none;
  }
  input:focus, select:focus, textarea:focus{ border-color:#2e7d32; box-shadow:0 0 0 3px rgba(46,125,50,.15) }
  .inline{ display:flex; align-items:center; gap:8px }
  .sep{ color:#777 }
  .hint{ color:#888; font-size:.85rem }
  .checkbox{ display:flex; gap:8px; align-items:center; user-select:none }

  /* ====== Buttons ====== */
  .form-actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  .btn{ padding:10px 14px; border-radius:12px; border:1px solid transparent; cursor:pointer }
  .btn-primary{ background:#2e7d32; color:#fff }
  .btn-primary:hover{ filter:brightness(.95) }
  .btn-ghost{ background:#f6f6f6; color:#333; border-color:#e6e6e6 }
  .status{ margin-left:auto; color:#555; font-size:.9rem }

  /* ====== Cert section spacing ====== */
  .card-cert{ margin-top:16px }
</style>

<script>
  // ==================== CONFIG BASE (reaproveite a sua, se j√° tiver) ====================
  const API_BASE =
    window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1"
      ? "http://127.0.0.1:8000"
      : "https://helptech-antunes-git-main-alisons-projects-f41ebd8c.vercel.app";

  async function downloadBlob(url, options, filename = "certificado.pdf") {
    const res = await fetch(url, options);
    if (!res.ok) throw new Error(`Erro ${res.status}`);
    const blob = await res.blob();
    const fileUrl = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = fileUrl;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(fileUrl), 2000);
  }

  // ==================== SUBMIT ====================
  const formCert = document.getElementById("formCertificado");
  const statusCert = document.getElementById("statusCert");

  formCert.addEventListener("submit", async (e) => {
    e.preventDefault();
    statusCert.textContent = "Gerando PDF...";

    // valida√ß√µes simples
    const nome = formCert.nome.value.trim();
    const curso = formCert.curso.value.trim();
    if (!nome || !curso) {
      statusCert.textContent = "Preencha os campos obrigat√≥rios.";
      return;
    }
    const data_inicio = formCert.data_inicio.value || null;
    const data_fim = formCert.data_fim.value || null;
    if (data_inicio && data_fim && data_inicio > data_fim) {
      statusCert.textContent = "Per√≠odo inv√°lido: in√≠cio depois do fim.";
      return;
    }

    const payload = {
      nome,
      curso,
      carga_horaria: formCert.carga.value ? Number(formCert.carga.value) : null,
      data_inicio,
      data_fim,
      data_conclusao: formCert.data_conclusao.value || null,
      instrutor: formCert.instrutor.value.trim() || null,
      local: formCert.local.value.trim() || null,
      assinatura: formCert.assinatura.value.trim() || null,
      template: formCert.template.value,
      cor_tema: formCert.cor_tema.value,
      incluir_qr: formCert.incluir_qr.checked,
      observacoes: formCert.observacoes.value.trim() || null
    };

    try {
      // Ajuste o endpoint conforme seu backend (ex.: /certificado ou /pdf/certificado)
      const url = `${API_BASE}/certificado`;
      await downloadBlob(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      }, `certificado_${nome.replace(/\s+/g,"_")}.pdf`);
      statusCert.textContent = "PDF gerado com sucesso.";
    } catch (err) {
      console.error(err);
      statusCert.textContent = "Falha ao gerar certificado.";
      alert("Erro ao gerar certificado: " + err.message);
    }
  });
</script>


  <script>
    // ==================== CONFIG BASE ====================
    // Reuse API_BASE defined in the previous script block to avoid redeclaration.

    // ==================== FUN√á√ÉO DOWNLOAD ====================
    async function download(url, filename = "arquivo.pdf") {
      try {
        const res = await fetch(url, { mode: "cors" });
        if (!res.ok) throw new Error(`Erro ${res.status}`);
        const blob = await res.blob();
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.click();
        URL.revokeObjectURL(link.href);
      } catch (err) {
        alert("Erro ao gerar PDF: " + err.message);
      }
    }

    // ==================== FORM OR√áAMENTO ====================
    document.getElementById("formOrc").addEventListener("submit", async (e) => {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(e.target));
      await download(`${API_BASE}/gerar-pdf?${params.toString()}`, "orcamento.pdf");
    });

    // ==================== FORM NOTA FISCAL ====================
    document.getElementById("formNF").addEventListener("submit", async (e) => {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(e.target));
      await download(`${API_BASE}/nota-fiscal?${params.toString()}`, "nota_fiscal.pdf");
    });

    // ==================== FORM CONTRATO ====================
    document.getElementById("formContrato").addEventListener("submit", async (e) => {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(e.target));
      await download(`${API_BASE}/contrato?${params.toString()}`, "contrato.pdf");
    });

    // ==================== FORM RECIBO ====================
    document.getElementById("formRecibo").addEventListener("submit", async (e) => {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(e.target));
      await download(`${API_BASE}/recibo?${params.toString()}`, "recibo.pdf");
    });

    // ==================== FORM CARTA ====================
    document.getElementById("formCarta").addEventListener("submit", async (e) => {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(e.target));
      await download(`${API_BASE}/carta?${params.toString()}`, "carta.pdf");
    });

    // ==================== FORM CERTIFICADO ====================
    document.getElementById("formCertificado").addEventListener("submit", async (e) => {
      e.preventDefault();
      const nome = e.target.nome.value;
      const curso = e.target.curso.value;
      const data = e.target.data.value;
      const url = `${API_BASE}/certificado?nome=${encodeURIComponent(nome)}&curso=${encodeURIComponent(curso)}&data=${encodeURIComponent(data)}`;
      await download(url, "certificado.pdf");
    });
  </script>

    <script src="app.js"></script>
</body>
</html>
